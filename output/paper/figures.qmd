---
title: "Figures"
format:
  pdf:
    pdf-engine: lualatex
    number-sections: true
    toc: false
    include-in-header:
      text: |
        \usepackage{lineno}
        \usepackage{rotating}
        \usepackage{float}
        \usepackage{typearea}
    include-before-body:
      text: |
        \linenumbers
link-citations: true
linkcolor: blue
editor_options: 
  chunk_output_type: console
execute:
  echo: false
  warning: false
  error: false
  message: false
---

```{r}
source("code/proc_res.R")
```

```{r vars}
store <- ifelse(
  Sys.getenv("is_hpc"), 
  paste0(
    "/PROJECTES/HELIX_OMICS/DATA_PREVIOUS_MIGRATION/",
    "lorenzoF/data/data_paper3/_targets/_targets_res"
  ), 
  "~/mounts/rstudioserver/data/data_paper3/_targets/_targets_res"
)

num_digits_est = 3
num_digits_sig = 2
```

- Number figures according to the order in which they are first mentioned in the main text.
- Clearly label all axes, giving both the measure and the unit of measurement.
- Smallest type size: 8pt.
- Maximum width: 7 inches in portrait, 9 inches in landscape mode.
- Multi-panel figures: capital letters followed by closing parenthesis, completely above and to the left of the panel.
- Use log-scale when plotting relative measures of effects.
- Figure titles and legends should be submitted as single paragraph.
- The text of figure legends typed after the reference list.
- Save and submit each main text figure as an individual file (PDF with fonts embedded).

# Participants

- Flow diagram: number of individuals at each stage of study. Report numbers potentially eligible, examined for eligibility, confirmed eligible, included in the study, completing follow-up, and analysed.

# Main results

- Forest plot for RQ2 (group by chemical class, and for each chemical group bars for metabolites) and RQ3.

## Marginal comparisons

```{r}
targets::tar_load(
  dplyr::matches("marginal_comparisons_(\\d)$"),
  store = store
)
```

```{r marginal-1}
#| label: fig-marginal-1
#| fig-cap: Average comparisons
#| fig-width: 6
#| fig-height: 7

tidy_res_meffects(
  df = marginal_comparisons_1,
  sa_var = NULL,
  which_res = "comparisons",
  num_digits_est = num_digits_est,
  num_digits_sig = num_digits_sig
)$plot
```

```{r marginal-2}
#| label: fig-marginal-2
#| fig-cap: Average comparisons
#| fig-width: 10
#| fig-height: 10

tidy_res_meffects(
  df = marginal_comparisons_2,
  sa_var = NULL,
  which_res = "comparisons",
  num_digits_est = num_digits_est,
  num_digits_sig = num_digits_sig
)$plot
```

```{r marginal-3}
#| label: fig-marginal-3
#| fig-cap: Average comparisons
#| fig-width: 5
#| fig-height: 5

tidy_res_meffects(
  df = marginal_comparisons_3,
  sa_var = NULL,
  which_res = "comparisons",
  num_digits_est = num_digits_est,
  num_digits_sig = num_digits_sig
)$plot
```
